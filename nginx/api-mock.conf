server {
  listen 80;
  server_name _;

  # CORS OK mÃªme avec Authorization + cookies/credentials
  add_header Access-Control-Allow-Origin $http_origin always;
  add_header Access-Control-Allow-Credentials "true" always;
  add_header Access-Control-Allow-Methods "GET,POST,PUT,PATCH,DELETE,OPTIONS" always;
  add_header Access-Control-Allow-Headers $http_access_control_request_headers always;
  add_header Access-Control-Max-Age 86400 always;
  add_header Vary "Origin" always;

  # Preflight
  if ($request_method = OPTIONS) { return 204; }

  # Fallback global /api/**
  location ^~ /api/ {
    default_type application/json;
    return 200 '{"ok":true,"path":"$request_uri"}';
  }

  location / { return 404; }
}
